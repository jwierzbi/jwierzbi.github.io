<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>jaro.blog - Documentation</title><link href="https://jaro.blog/" rel="alternate"></link><link href="https://jaro.blog/feeds/documentation.atom.xml" rel="self"></link><id>https://jaro.blog/</id><updated>2021-06-07T00:00:00+08:00</updated><entry><title>Conditional content removal using Docutils classes</title><link href="https://jaro.blog/blog/content-removal-with-docutils-classes.html" rel="alternate"></link><published>2021-06-07T00:00:00+08:00</published><updated>2021-06-07T00:00:00+08:00</updated><author><name>Jaros≈Çaw Wierzbicki</name></author><id>tag:jaro.blog,2021-06-07:/blog/content-removal-with-docutils-classes.html</id><summary type="html">&lt;p&gt;Some time ago I had a problem where I had to exclude parts of one of my
documents based on a build-time condition. I wanted to maintain one document but
produce two versions: one that contained internal details of a product and one
that didn't.&lt;/p&gt;
&lt;p&gt;Nowadays I use &lt;a class="reference external" href="https://docutils.sourceforge.io/rst.html"&gt;reStructuredText&lt;/a&gt; (reST) and &lt;a class="reference external" href="https://docutils.sourceforge.io"&gt;Docutils&lt;/a&gt; for writing my documents
so naturally, I started Googling how to do it with the help of those tools.
After some research, I found an out-of-the-box solution (unsurprisingly because
we all have similar problems üòâ). It may surprise you if you haven't
looked into this problem before.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Some time ago I had a problem where I had to exclude parts of one of my
documents based on a build-time condition. I wanted to maintain one document but
produce two versions: one that contained internal details of a product and one
that didn't.&lt;/p&gt;
&lt;p&gt;Nowadays I use &lt;a class="reference external" href="https://docutils.sourceforge.io/rst.html"&gt;reStructuredText&lt;/a&gt; (reST) and &lt;a class="reference external" href="https://docutils.sourceforge.io"&gt;Docutils&lt;/a&gt; for writing my documents
so naturally, I started Googling how to do it with the help of those tools.
After some research, I found an out-of-the-box solution (unsurprisingly because
we all have similar problems üòâ). It may surprise you if you haven't
looked into this problem before.&lt;/p&gt;

&lt;div class="section" id="the-class-directive"&gt;
&lt;h2&gt;The &lt;em&gt;class&lt;/em&gt; directive&lt;/h2&gt;
&lt;p&gt;As the title reveals, the solution is the Docutils' &lt;em&gt;class&lt;/em&gt; directive. But
before we get to the main point let us explore what it can do and how it works
first. This will make the next (main) step more clear.&lt;/p&gt;
&lt;p&gt;The class directive allows adding a class attribute to document nodes. For
example, this can be useful for applying styles when generating HTML output.&lt;/p&gt;
&lt;p&gt;The class attribute can be applied in 2 ways:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;to a &lt;a class="reference external" href="https://docutils.sourceforge.io/docs/ref/doctree.html#id205"&gt;structural element&lt;/a&gt;, e.g. a section&lt;/li&gt;
&lt;li&gt;to a &lt;a class="reference external" href="https://docutils.sourceforge.io/docs/ref/doctree.html#id209"&gt;body element&lt;/a&gt; (simple or compound), e.g. a paragraph&lt;/li&gt;
&lt;/ul&gt;
&lt;p id="listing-01"&gt;For example, we might want to add a &lt;code&gt;subsection&lt;/code&gt; class to a subsection
of a document, &lt;code&gt;paragraph&lt;/code&gt; and &lt;code&gt;emphasised&lt;/code&gt; classes to a paragraph
(we can apply more than one) and a &lt;code&gt;compound-body&lt;/code&gt; to a list.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; Title
 =====

 Subtitle
 --------

&lt;span class="hll"&gt;&lt;span class="p"&gt; ..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; subsection
&lt;/span&gt;
 Section is a structural element
 &amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;

&lt;span class="hll"&gt;&lt;span class="p"&gt; ..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; paragraph emphasised
&lt;/span&gt;
 A paragraph is a simple body element.

&lt;span class="hll"&gt;&lt;span class="p"&gt; ..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; list
&lt;/span&gt;
 &lt;span class="m"&gt;-&lt;/span&gt; Bullet list,
 &lt;span class="m"&gt;-&lt;/span&gt; is a compound body element.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The above document will be converted to a document tree that will look something
like the below:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;document&amp;gt;&lt;/span&gt;
     &lt;span class="nt"&gt;&amp;lt;title&amp;gt;&lt;/span&gt;
         Title
     &lt;span class="nt"&gt;&amp;lt;subtitle&amp;gt;&lt;/span&gt;
         Subtitle
&lt;span class="hll"&gt;     &lt;span class="nt"&gt;&amp;lt;section&lt;/span&gt; &lt;span class="na"&gt;classes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;subsection&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;         &lt;span class="nt"&gt;&amp;lt;title&amp;gt;&lt;/span&gt;
             Section is a structural element
&lt;span class="hll"&gt;         &lt;span class="nt"&gt;&amp;lt;paragraph&lt;/span&gt; &lt;span class="na"&gt;classes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;paragraph emphasised&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;             A paragraph is a simple body element.
&lt;span class="hll"&gt;         &lt;span class="nt"&gt;&amp;lt;bullet_list&lt;/span&gt; &lt;span class="na"&gt;classes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;list&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;             &lt;span class="nt"&gt;&amp;lt;list_item&amp;gt;&lt;/span&gt;
                 &lt;span class="nt"&gt;&amp;lt;paragraph&amp;gt;&lt;/span&gt;
                     Bullet list,
             &lt;span class="nt"&gt;&amp;lt;list_item&amp;gt;&lt;/span&gt;
                 &lt;span class="nt"&gt;&amp;lt;paragraph&amp;gt;&lt;/span&gt;
                     is a compound body element.
&lt;/pre&gt;&lt;/div&gt;
&lt;p class="message-body message"&gt;The above output is a so-called &lt;a class="reference external" href="https://docutils.sourceforge.io/docs/ref/doctree.html#pseudo-xml"&gt;pseudo-XML&lt;/a&gt;. It‚Äôs a format used
in Docutils for presenting a document tree in a easy-to-understand
way. Note that for simplicity some of the node attributes were
removed.&lt;/p&gt;
&lt;p&gt;As you can see some elements in the tree were assigned a &lt;code&gt;classes&lt;/code&gt;
attribute. Those are the same elements that we preceded with the class
directives. The general rule is that the directive is applied to a whole node
following the directive, so:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Class applied to a structural node applies to the whole node, e.g. to the
whole section.&lt;/li&gt;
&lt;li&gt;Class applied to a simple body element applies only to that element, e.g.
to a paragraph.&lt;/li&gt;
&lt;li&gt;Class applied to a compound body element applies to the whole element but not
to its children, e.g. to the top element of a list but not the list elements.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You might wonder what's going to happen when we apply a class to more than one
body element? Do we have to prepend every element with a class directive? If we
follow the previous example then yes but there's a better way:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; Title
 =====

 Subtitle
 --------

 Section is a structural element
 &amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;

&lt;span class="hll"&gt;&lt;span class="p"&gt; ..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; a-block
&lt;/span&gt;
     A paragraph is a simple body element.

     &lt;span class="m"&gt;-&lt;/span&gt; Bullet list
     &lt;span class="m"&gt;-&lt;/span&gt; is a compound body element.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The above example will give a document tree with the below structure:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;document&amp;gt;&lt;/span&gt;
     &lt;span class="nt"&gt;&amp;lt;title&amp;gt;&lt;/span&gt;
         Title
     &lt;span class="nt"&gt;&amp;lt;subtitle&amp;gt;&lt;/span&gt;
         Subtitle
     &lt;span class="nt"&gt;&amp;lt;section&amp;gt;&lt;/span&gt;
         &lt;span class="nt"&gt;&amp;lt;title&amp;gt;&lt;/span&gt;
             Section is a structural element
&lt;span class="hll"&gt;         &lt;span class="nt"&gt;&amp;lt;paragraph&lt;/span&gt; &lt;span class="na"&gt;classes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;a-block&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;             A paragraph is a simple body element.
&lt;span class="hll"&gt;         &lt;span class="nt"&gt;&amp;lt;bullet_list&lt;/span&gt; &lt;span class="na"&gt;classes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;a-block&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;             &lt;span class="nt"&gt;&amp;lt;list_item&amp;gt;&lt;/span&gt;
                 &lt;span class="nt"&gt;&amp;lt;paragraph&amp;gt;&lt;/span&gt;
                     Bullet list
             &lt;span class="nt"&gt;&amp;lt;list_item&amp;gt;&lt;/span&gt;
                 &lt;span class="nt"&gt;&amp;lt;paragraph&amp;gt;&lt;/span&gt;
                     is a compound body element.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice how the indented block was placed directly in the subsection and the
class &lt;code&gt;a-block&lt;/code&gt; was applied to each of the indented elements. This works
with the body elements only. If we try to do it for any of the structural
elements it won't work, i.e. sections can't be in the class' indented block.&lt;/p&gt;
&lt;p&gt;Class directives can also be nested:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; Title
 =====

 Subtitle
 --------

 Section is a structural element
 &amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;&amp;quot;

&lt;span class="hll"&gt;&lt;span class="p"&gt; ..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; level-0
&lt;/span&gt;
     Paragraph at level 0.

&lt;span class="hll"&gt;&lt;span class="p"&gt;     ..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; level-1
&lt;/span&gt;
         Paragraph at level 1.

&lt;span class="hll"&gt;&lt;span class="p"&gt;         ..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; level-2
&lt;/span&gt;
             Paragraphs at level 2.

&lt;span class="hll"&gt;&lt;span class="p"&gt;             ..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; level-3
&lt;/span&gt;
                 Paragraph at level 3.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Which would results in:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;document&amp;gt;&lt;/span&gt;
     &lt;span class="nt"&gt;&amp;lt;title&amp;gt;&lt;/span&gt;
         Title
     &lt;span class="nt"&gt;&amp;lt;subtitle&amp;gt;&lt;/span&gt;
         Subtitle
     &lt;span class="nt"&gt;&amp;lt;section&amp;gt;&lt;/span&gt;
         &lt;span class="nt"&gt;&amp;lt;title&amp;gt;&lt;/span&gt;
             Section is a structural element
&lt;span class="hll"&gt;         &lt;span class="nt"&gt;&amp;lt;paragraph&lt;/span&gt; &lt;span class="na"&gt;classes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;level-0&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;             Paragraph at level 0.
&lt;span class="hll"&gt;         &lt;span class="nt"&gt;&amp;lt;paragraph&lt;/span&gt; &lt;span class="na"&gt;classes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;level-1 level-0&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;             Paragraph at level 1.
&lt;span class="hll"&gt;         &lt;span class="nt"&gt;&amp;lt;paragraph&lt;/span&gt; &lt;span class="na"&gt;classes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;level-2 level-1 level-0&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;             Paragraphs at level 2.
&lt;span class="hll"&gt;         &lt;span class="nt"&gt;&amp;lt;paragraph&lt;/span&gt; &lt;span class="na"&gt;classes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;level-3 level-2 level-1 level-0&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;             Paragraph at level 3.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That's pretty cool, right? üòÅ&lt;/p&gt;
&lt;p&gt;In all the above examples, we applied the class directive to the whole compound
body elements but it's also possible to do it to individual items, e.g. in
the case of a list:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt; ..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; list

 &lt;span class="m"&gt;-&lt;/span&gt; Bullet list,

&lt;span class="hll"&gt;&lt;span class="p"&gt; ..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; list-item
&lt;/span&gt;
 &lt;span class="m"&gt;-&lt;/span&gt; is a compound
 &lt;span class="m"&gt;-&lt;/span&gt; body element
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The class in such case is applied to the second item only:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;bullet_list&lt;/span&gt; &lt;span class="na"&gt;classes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;list&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
     &lt;span class="nt"&gt;&amp;lt;list_item&amp;gt;&lt;/span&gt;
         &lt;span class="nt"&gt;&amp;lt;paragraph&amp;gt;&lt;/span&gt;
             Bullet list,
&lt;span class="hll"&gt;     &lt;span class="nt"&gt;&amp;lt;list_item&lt;/span&gt; &lt;span class="na"&gt;classes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;list-item&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;         &lt;span class="nt"&gt;&amp;lt;paragraph&amp;gt;&lt;/span&gt;
             is a compound
     &lt;span class="nt"&gt;&amp;lt;list_item&amp;gt;&lt;/span&gt;
         &lt;span class="nt"&gt;&amp;lt;paragraph&amp;gt;&lt;/span&gt;
             body element
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Just remember that the class directive, in this case, must be properly aligned
with the preceding list item, otherwise it won't work as expected.&lt;/p&gt;
&lt;p&gt;Now that we know everything (or at least enough üòâ) about the class
directive let's move to the main point.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="excluding-nodes-of-a-specific-class"&gt;
&lt;h2&gt;Excluding nodes of a specific class&lt;/h2&gt;
&lt;p&gt;The lengthy explanation above led us to this point where we can now comfortably
try and tackle the main problem. This part will be much shorter.&lt;/p&gt;
&lt;p&gt;In Docutils classes can be used for one more thing besides what classes are
usually used for: they allow to exclude nodes from the document. This can be
done by passing a class name to the &lt;code&gt;--strip-elements-with-class&lt;/code&gt; option
of the &lt;code&gt;rst2xxx.py&lt;/code&gt; family of commands, e.g.:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;rst2html5.py --strip-elements-with-class&lt;span class="o"&gt;=&lt;/span&gt;internal doc.rst
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The above command will generate an HTML document with all of the nodes with
an &lt;code&gt;internal&lt;/code&gt; class removed. That's right, it's that easy üòâ.&lt;/p&gt;
&lt;p&gt;So if the &lt;em&gt;doc.rst&lt;/em&gt; looks like below:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gh"&gt;Title&lt;/span&gt;
&lt;span class="gh"&gt;=====&lt;/span&gt;

&lt;span class="p"&gt;..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; internal

&lt;span class="gh"&gt;Internal section&lt;/span&gt;
&lt;span class="gh"&gt;----------------&lt;/span&gt;

Internal content.

&lt;span class="p"&gt;..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; external

&lt;span class="gh"&gt;External section&lt;/span&gt;
&lt;span class="gh"&gt;----------------&lt;/span&gt;

External content.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then the HTML output will look something like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt; &lt;span class="na"&gt;xmlns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://www.w3.org/1999/xhtml&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;xml:lang&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;en&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;lang&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;en&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="c"&gt;&amp;lt;!-- ... --&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;document&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;title&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;title&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Title&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;external section&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;external-section&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;External section&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;External content.&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Further, we'll explore how the class directive is implemented. Feel free to skip
that part if you're not interested.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-does-it-work"&gt;
&lt;h2&gt;How does it work?&lt;/h2&gt;
&lt;p&gt;Docutils has two concepts that are involved in processing classes. There is
a &lt;em&gt;directive&lt;/em&gt; and there is a &lt;em&gt;transform&lt;/em&gt;.&lt;/p&gt;
&lt;div class="section" id="directive"&gt;
&lt;h3&gt;Directive&lt;/h3&gt;
&lt;p&gt;Directives &lt;a class="footnote-reference" href="#id10" id="id1"&gt;[1]&lt;/a&gt; &lt;a class="footnote-reference" href="#id11" id="id2"&gt;[2]&lt;/a&gt; are an extension mechanism for the reStructuredText markup
language. Each directive starts with a double full stop and whitespace and
ends with a double colon and whitespace with the directive type in between
e.g. &lt;code&gt;.. class:: class-name&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Directives are a very flexible way of extending Docutils &lt;a class="footnote-reference" href="#id12" id="id3"&gt;[3]&lt;/a&gt; so let's take
a look at the code of the class directive &lt;a class="footnote-reference" href="#id13" id="id4"&gt;[4]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Each directive extends the &lt;code&gt;docutils.parsers.rst.Directive&lt;/code&gt; &lt;a class="footnote-reference" href="#id14" id="id5"&gt;[5]&lt;/a&gt; base
class and implements &lt;code&gt;run&lt;/code&gt; method:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;docutils.parsers.rst&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Directive&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Class&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Directive&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;required_arguments&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
    &lt;span class="n"&gt;optional_arguments&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
    &lt;span class="n"&gt;final_argument_whitespace&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;
    &lt;span class="n"&gt;has_content&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can pass some configuration parameters as class variables like the above
&lt;code&gt;required_arguments = 1&lt;/code&gt; which tells the parser to look for at least one
parameter for the directive, which in this case are the names of classes or
&lt;code&gt;has_content = True&lt;/code&gt; which indicates to the parser that the class
directive accepts indented blocks as it's content.&lt;/p&gt;
&lt;p&gt;Further, let's look at what is inside the &lt;code&gt;run&lt;/code&gt; method:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;class_value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;directives&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;class_option&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arguments&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

    &lt;span class="n"&gt;node_list&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;node_list&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;run&lt;/code&gt; method deals with two cases:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;If the &lt;code&gt;self.content&lt;/code&gt; variable is not empty it means that there was
a block (indented) passed to the directive.&lt;/li&gt;
&lt;li&gt;If the &lt;code&gt;self.content&lt;/code&gt; is empty the directive will affect the next node
in the content tree (a next sibling).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The first case where an indented block was passed to the directive is handled
like below:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;container&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Element&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;state&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;nested_parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;content_offset&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;container&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;container&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;classes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;class_value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;node_list&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;container&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;children&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;First, we create an empty element that will serve as a container for the content
included in the nested block: &lt;code&gt;container = nodes.Element()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Next, we parse the directive's content with the call to &lt;code&gt;nested_parse()&lt;/code&gt;
&lt;a class="footnote-reference" href="#id15" id="id6"&gt;[6]&lt;/a&gt;. This will add children elements created from &lt;code&gt;self.content&lt;/code&gt; and put
them into the &lt;code&gt;container&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We then iterate over all of the created children in the container and add the
class name to the node's &lt;code&gt;classes&lt;/code&gt; attribute.&lt;/p&gt;
&lt;p&gt;As the last step, we add all of the &lt;code&gt;container&lt;/code&gt;'s children to the
&lt;code&gt;node_list&lt;/code&gt; which is going to be returned from the &lt;code&gt;run&lt;/code&gt; method.&lt;/p&gt;
&lt;p&gt;In the second case:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;pending&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pending&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;misc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ClassAttribute&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;class&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;class_value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;directive&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;block_text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;state_machine&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;document&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;note_pending&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pending&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;node_list&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pending&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Since there is no content directly associated with the class directive we will
apply the class to the next element in the element tree (in other words to a
sibling). To do that we need to defer this operation until the whole document
is parsed (since we don't know our sibling yet).&lt;/p&gt;
&lt;p&gt;To postpone applying our class to the sibling we create and insert a &lt;em&gt;pending&lt;/em&gt;
node. This node will then be processed by a &lt;a class="reference internal" href="#transform"&gt;Transform&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To create the pending node we use the &lt;code&gt;nodes.pending&lt;/code&gt; method and pass
3 arguments to it: the &lt;code&gt;misc.ClassAttribute&lt;/code&gt; transform class (this is
the operation that will be executed on the pending node later), an options
dictionary and a &lt;code&gt;self.block_text&lt;/code&gt; (which is a string containing the
whole directive).&lt;/p&gt;
&lt;p&gt;We then add this node to the &lt;code&gt;node_list&lt;/code&gt; which will be returned from
the &lt;code&gt;run()&lt;/code&gt; method.&lt;/p&gt;
&lt;p&gt;That's pretty much everything that the class directive implementation is doing.
Next (&lt;a class="reference internal" href="#transform"&gt;Transform&lt;/a&gt;) we'll see what happens with the pending node that we created.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="transform"&gt;
&lt;h3&gt;Transform&lt;/h3&gt;
&lt;p&gt;Transforms &lt;a class="footnote-reference" href="#id16" id="id7"&gt;[7]&lt;/a&gt; are run after the whole document has been parsed and their
purpose is to change the document tree in place. They can perform different
operations like resolving references or removing elements based on a
certain condition.&lt;/p&gt;
&lt;p&gt;We'll take a look at the &lt;code&gt;ClassAttribute&lt;/code&gt; &lt;a class="footnote-reference" href="#id17" id="id8"&gt;[8]&lt;/a&gt; transform that is used by the
&lt;code&gt;Class&lt;/code&gt; directive class.&lt;/p&gt;
&lt;p&gt;Each transform object derives from the &lt;code&gt;docutils.tranforms.Transform&lt;/code&gt; &lt;a class="footnote-reference" href="#id18" id="id9"&gt;[9]&lt;/a&gt;
class and implements the &lt;code&gt;apply&lt;/code&gt; method.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ClassAttribute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Transform&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;default_priority&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;210&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That's pretty straightforward. One thing that is worth mentioning is that the
transforms are run in order according to their priorities hence the class
attribute &lt;code&gt;default_priority&lt;/code&gt; above.&lt;/p&gt;
&lt;p&gt;Next, let's take a look at the &lt;code&gt;apply&lt;/code&gt; method implementation:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;pending&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;startnode&lt;/span&gt;
    &lt;span class="n"&gt;parent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pending&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parent&lt;/span&gt;
    &lt;span class="n"&gt;child&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pending&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="n"&gt;parent&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;index&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parent&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;
            &lt;span class="c1"&gt;# ...&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;child&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;parent&lt;/span&gt;
            &lt;span class="n"&gt;parent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;parent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parent&lt;/span&gt;
    &lt;span class="n"&gt;error&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;document&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reporter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;pending&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace_self&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let's look at how the &lt;code&gt;for&lt;/code&gt; loop works first and then we'll check what's
happening inside of it.&lt;/p&gt;
&lt;p&gt;First, we get a reference to the pending node that was added in the &lt;code&gt;Class&lt;/code&gt;
class and to its parent. Then we go into a &lt;code&gt;while&lt;/code&gt; loop that will
loop as long as the &lt;code&gt;parent&lt;/code&gt; node exists.&lt;/p&gt;
&lt;p&gt;In the &lt;code&gt;while&lt;/code&gt; loop there is &lt;code&gt;for ... else&lt;/code&gt; construct which in short
loops over indices in a range. If there are no indices to loop over (no elements
at all) or no &lt;code&gt;break&lt;/code&gt; is executed inside the loop, it will jump to the
&lt;code&gt;else&lt;/code&gt; block.&lt;/p&gt;
&lt;p&gt;So in the above case, we generate a range of indices of children that are
&amp;quot;behind&amp;quot; the pending node (i.e. siblings of the pending node that are following
the node in the tree). If there are siblings like that we execute whatever is
inside the &lt;code&gt;for&lt;/code&gt; loop and return (well that depends on what's in the loop
of course). If there are no siblings following the pending node (which can
happen if we put &lt;code&gt;.. class::&lt;/code&gt; before for &lt;a class="reference internal" href="#listing-01"&gt;example&lt;/a&gt; a
section) we go level up in the node tree (the &lt;code&gt;else&lt;/code&gt; clause) and repeat
the operation until we find a node that we're looking for.&lt;/p&gt;
&lt;p&gt;Finally, if we don't find any nodes that we can apply our operations to, we
replace the pending node with an error node.&lt;/p&gt;
&lt;p&gt;The operations we apply to the nodes once we find them are pretty
straightforward:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;index&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parent&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;
    &lt;span class="n"&gt;element&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;parent&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;isinstance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Invisible&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt;
        &lt;span class="nb"&gt;isinstance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system_message&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;
        &lt;span class="k"&gt;continue&lt;/span&gt;
    &lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;classes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;pending&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;details&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;class&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;pending&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remove&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pending&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The whole idea here is to get the first eligible sibling that exists after the
pending node (or its parent, or its parent's parent, etc.) and add the
&lt;code&gt;classes&lt;/code&gt; attribute to it (same as we did in the &lt;code&gt;Class&lt;/code&gt;
implementation) and then if that happens, remove the pending node and return.&lt;/p&gt;
&lt;p&gt;There are some exceptions like the &lt;code&gt;nodes.Invisible&lt;/code&gt; and
&lt;code&gt;nodes.system_message&lt;/code&gt; nodes that are skipped over in the loop but that's
not important here. Let's just say that those node types don't qualify as
regular nodes so classes can't be applied to them.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="summary"&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;Classes are an excellent way of e.g. customising how a document looks without
writing any extensions to Docutils. They also allow control of what goes into
a document and what doesn't. Of course, there are certain limitations of this
mechanism but for a large number of the use cases, they should be a great, quick
and easy way to achieve the desired outcome when writing our documentation.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="further-reading"&gt;
&lt;h2&gt;Further reading&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docutils.sourceforge.io/docs/ref/rst/restructuredtext.html"&gt;reStructuredText Markup Specification&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docutils.sourceforge.io/"&gt;Docutils: Documentation Utilities&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docutils.sourceforge.io/docs/dev/hacking.html"&gt;Docutils Hacker's Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docutils.sourceforge.io/docs/user/config.html"&gt;Docutils Configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docutils.sourceforge.io/docs/ref/doctree.html"&gt;The Docutils Document Tree&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://sourceforge.net/p/docutils/code/HEAD/tree/trunk/docutils/"&gt;Docutils repository&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr class="docutils" /&gt;
&lt;ul class="footnotes"&gt;
    &lt;li&gt;
        &lt;span class="docutils footnote" id="id10"&gt;
            &lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;
        &lt;/span&gt;
        &lt;span&gt;
            &lt;a class="reference external" href="https://docutils.sourceforge.io/docs/ref/rst/restructuredtext.html#directives"&gt;reStructuredText Markup Specification, Directives&lt;/a&gt;
        &lt;/span&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;span class="docutils footnote" id="id11"&gt;
            &lt;a class="fn-backref" href="#id2"&gt;[2]&lt;/a&gt;
        &lt;/span&gt;
        &lt;span&gt;
            &lt;a class="reference external" href="https://docutils.sourceforge.io/docs/ref/rst/directives.html"&gt;reStructuredText Directives&lt;/a&gt;
        &lt;/span&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;span class="docutils footnote" id="id12"&gt;
            &lt;a class="fn-backref" href="#id3"&gt;[3]&lt;/a&gt;
        &lt;/span&gt;
        &lt;span&gt;
            &lt;a class="reference external" href="https://docutils.sourceforge.io/docs/howto/rst-directives.html"&gt;Creating reStructuredText Directives&lt;/a&gt;
        &lt;/span&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;span class="docutils footnote" id="id13"&gt;
            &lt;a class="fn-backref" href="#id4"&gt;[4]&lt;/a&gt;
        &lt;/span&gt;
        &lt;span&gt;
            &lt;a class="reference external" href="https://github.com/docutils-mirror/docutils/blob/e88c5fb08d5cdfa8b4ac1020dd6f7177778d5990/docutils/parsers/rst/directives/misc.py#L327"&gt;https://github.com/docutils-mirror/docutils, docutils/parsers/rst/directives/misc.py:327&lt;/a&gt;
        &lt;/span&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;span class="docutils footnote" id="id14"&gt;
            &lt;a class="fn-backref" href="#id5"&gt;[5]&lt;/a&gt;
        &lt;/span&gt;
        &lt;span&gt;
            &lt;a class="reference external" href="https://github.com/docutils-mirror/docutils/blob/e88c5fb08d5cdfa8b4ac1020dd6f7177778d5990/docutils/parsers/rst/__init__.py#L194"&gt;https://github.com/docutils-mirror/docutils, docutils/parsers/rst/__init__.py:194&lt;/a&gt;
        &lt;/span&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;span class="docutils footnote" id="id15"&gt;
            &lt;a class="fn-backref" href="#id6"&gt;[6]&lt;/a&gt;
        &lt;/span&gt;
        &lt;span&gt;
            &lt;a class="reference external" href="https://github.com/docutils-mirror/docutils/blob/e88c5fb08d5cdfa8b4ac1020dd6f7177778d5990/docutils/parsers/rst/states.py#L257"&gt;https://github.com/docutils-mirror/docutils, docutils/parsers/rst/states.py:257&lt;/a&gt;
        &lt;/span&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;span class="docutils footnote" id="id16"&gt;
            &lt;a class="fn-backref" href="#id7"&gt;[7]&lt;/a&gt;
        &lt;/span&gt;
        &lt;span&gt;
            &lt;a class="reference external" href="https://docutils.sourceforge.io/docs/ref/transforms.html"&gt;Docutils Transforms&lt;/a&gt;
        &lt;/span&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;span class="docutils footnote" id="id17"&gt;
            &lt;a class="fn-backref" href="#id8"&gt;[8]&lt;/a&gt;
        &lt;/span&gt;
        &lt;span&gt;
            &lt;a class="reference external" href="https://github.com/docutils-mirror/docutils/blob/e88c5fb08d5cdfa8b4ac1020dd6f7177778d5990/docutils/transforms/misc.py#L35"&gt;https://github.com/docutils-mirror/docutils, docutils/transforms/misc.py:35&lt;/a&gt;
        &lt;/span&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;span class="docutils footnote" id="id18"&gt;
            &lt;a class="fn-backref" href="#id9"&gt;[9]&lt;/a&gt;
        &lt;/span&gt;
        &lt;span&gt;
            &lt;a class="reference external" href="https://github.com/docutils-mirror/docutils/blob/e88c5fb08d5cdfa8b4ac1020dd6f7177778d5990/docutils/transforms/__init__.py#L33"&gt;https://github.com/docutils-mirror/docutils, docutils/transforms/__init__.py:33&lt;/a&gt;
        &lt;/span&gt;
    &lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="Documentation"></category><category term="Docutils"></category><category term="documentation"></category><category term="reStructuredText"></category><category term="reST"></category></entry></feed>