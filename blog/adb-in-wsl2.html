<!DOCTYPE html> <html lang=en > <meta charset=utf-8 > <link href="https://blog.laobo.dev/feeds/all.atom.xml" type="application/atom+xml" rel=alternate  title="blog.laobo.dev Full Atom Feed"> <link href="https://blog.laobo.dev/feeds/tips-tricks.atom.xml" type="application/atom+xml" rel=alternate  title="blog.laobo.dev Categories Atom Feed"> <meta name=viewport  content="width=device-width, initial-scale=1.0, maximum-scale=5.0"> <meta http-equiv=X-UA-Compatible  content="ie=edge"> <meta name=description  content="Don't know how to connect to your Android device from Windows Subsystem for Linux (WSL2) via ADB? Find out from this article."> <title>blog.laobo.dev - Connecting to Android device from Windows Subsystem for Linux using ADB</title> <link rel=icon  href="https://blog.laobo.dev/theme/img/favicon.ico" sizes="16x16 24x24 32x32 64x64 128x128" type="image/png"> <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel=stylesheet  integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin=anonymous > <link href="https://blog.laobo.dev/theme/css/minimal.css" rel=stylesheet > <script src="https://blog.laobo.dev/theme/js/minimal.js"></script> <meta name=tags  content=ADB  /> <meta name=tags  content=Android  /> <meta name=tags  content=Linux  /> <meta name=tags  content=Windows  /> <meta name=tags  content=WSL  /> <meta name=tags  content=WSL2  /> <nav class=navbar  role=navigation  aria-label="main navigation"> <div class=container > <div class=navbar-brand > <a class=navbar-item  href="https://blog.laobo.dev/"> <img src="https://blog.laobo.dev/theme/img/logo.png" alt=blog.laobo.dev > </a> <span class="navbar-burger burger" data-target=navbarMenu  aria-label=menu  aria-expanded=false > <span aria-hidden=true ></span> <span aria-hidden=true ></span> <span aria-hidden=true ></span> </span> </div> <div id=navbarMenu  class=navbar-menu > <div class=navbar-end > <a class="navbar-item " href="https://blog.laobo.dev/"> Home </a> <a class=navbar-item  href="https://blog.laobo.dev/pages/about.html"> About me </a> <div class="navbar-item has-dropdowns is-hoverable"> <span class=navbar-link > Categories </span> <div class="navbar-dropdown is-shadowless"> <a class=navbar-item  href="https://blog.laobo.dev/category/documentation.html"> Documentation </a> <a class="navbar-item is-active" href="https://blog.laobo.dev/category/tips-tricks.html"> Tips & Tricks </a> <a class=navbar-item  href="https://blog.laobo.dev/category/web-development.html"> Web development </a> </div> </div> </div> </div> </div> </nav> <section class="hero is-light is-small"> <div class=hero-body > <div class="container has-text-centered"> <h2 class=subtitle > Category: <a href="https://blog.laobo.dev/category/tips-tricks.html">Tips & Tricks</a> </h2> </div> </div> </section> <section class="section articles"> <div class=container > <article class="card article"> <div class=card-content > <div class=article-header > <div class=has-text-centered > <h1 class="title article-title"> <a href="https://blog.laobo.dev/blog/adb-in-wsl2.html" rel=bookmark  title="Permalink to Connecting to Android device from Windows Subsystem for Linux using ADB"> Connecting to Android device from Windows Subsystem for Linux using ADB </a> </h1> <p class="subtitle is-6 article-subtitle"> <a href="https://blog.laobo.dev/author/jaroslaw-wierzbicki.html">JarosÅ‚aw Wierzbicki</a>, on <time class=published  datetime="2021-06-01T00:00:00+08:00">Tue 01 June 2021</time> </p> </div> <div class="tags are-normal is-centered"> <span class=tag > <a href="https://blog.laobo.dev/tag/adb.html">ADB</a> </span> <span class=tag > <a href="https://blog.laobo.dev/tag/android.html">Android</a> </span> <span class=tag > <a href="https://blog.laobo.dev/tag/linux.html">Linux</a> </span> <span class=tag > <a href="https://blog.laobo.dev/tag/windows.html">Windows</a> </span> <span class=tag > <a href="https://blog.laobo.dev/tag/wsl.html">WSL</a> </span> <span class=tag > <a href="https://blog.laobo.dev/tag/wsl2.html">WSL2</a> </span> </div> </div> <div class="content article-body"> <p>A few weeks ago COVID-19 finally hit Taiwan (so far we've been doing pretty well) and I had to move to work from home like the rest of the world (well at least some of it). This forced me to use my work laptop for more than meetings.</p> <p>Normally I use a Linux PC for daily work so to get at least some of the comfort back I've set up Windows Subsystem for Linux version 2 (WSL2) on the laptop.</p> <p>This didn't go without a few bumps along the way. The biggest one was the fact that WSL2 doesn't support accessing USB devices (version 1 allegedly does <a class=footnote-reference  href="#footnote-1" id=footnote-reference-1 >[1]</a> but I didn't have a chance to check) from Linux. And this was a problem for me since I need to connect to an Android device frequently.</p> <p>But as long as there's Internet there's hope. After digging for some time I wasn't disappointed because it turned out that there is a solution to this problem.</p> <div class=section  id=how-does-android-debug-bridge-adb-work > <h2>How does Android Debug Bridge (ADB) work?</h2> <p>Let's just quickly look at how the Android Debug Bridge (ADB) works.</p> <p>ADB is a command line tool that implements client-server architecture <a class=footnote-reference  href="#footnote-2" id=footnote-reference-2 >[2]</a>. It consists of three parts:</p> <ul class=simple > <li>A client, which runs on a development machine and sends commands to the device with the help of the server. This is the <code>adb</code> command line tool. <li>A server, which runs on the development machine and communicates directly with the device (daemon). It accepts commands from the client and forwards them to the device (it's started by <code>adb</code>). <li>A daemon (<code>adbd</code>), which runs on a device and accepts commands from the server. </ul> <p>When we execute <code>adb</code> command it tries to connect to the server. If the server is not running it's going to be automatically started:</p> <div class=highlight ><pre><span></span> $ adb devices
<span class=hll > * daemon not running; starting now at tcp:5037
</span> * daemon started successfully
 List of devices attached
 0123456789A     device
</pre></div> <p>Sure enough when we list the processes:</p> <div class=highlight ><pre><span></span> $ ps -eo pid,command | awk &#39;!/grep/ &amp;&amp; /adb/&#39;
<span class=hll > 599501 adb -L tcp:5037 fork-server server --reply-fd 4
</span></pre></div> <p>We can see that the ADB server is running in the background. The above line also tells us that the server is listening on TCP socket localhost:5037 (localhost is implicit here).</p> <p>The fact that the server is listening on a TCP socket already hints at how we can make the ADB working in WSL2.</p> </div> <div class=section  id=connecting-from-wsl-to-adb > <h2>Connecting from WSL to ADB</h2> <p>As I already mentioned we need a server and a client to connect to an Android device. Let's take a look at how to set those two up.</p> <div class=section  id=the-server > <h3>The server</h3> <p>The first thing we have to do is to determine the version of the client that runs in WSL. We can do that by running (in WSL):</p> <div class=highlight ><pre><span></span> $ adb version
<span class=hll > Android Debug Bridge version 1.0.41
</span> Version 30.0.4-6686687
 Installed as /home/jaro/platform-tools/adb
</pre></div> <p>In my case, it's 1.0.41. This is important because we need to match this version on the Windows side. The easiest way is just to download the appropriate version for example from <a class="reference external" href="https://androidmtk.com/download-android-sdk-platform-tools">this website</a>. But there are also other methods <a class=footnote-reference  href="#footnote-3" id=footnote-reference-3 >[3]</a> <a class=footnote-reference  href="#footnote-4" id=footnote-reference-4 >[4]</a> if you don't feel comfortable downloading stuff from random websites on the Internet ðŸ˜‰.</p> <p>When we get the appropriate version of the tool set up in our Windows we can check if the version indeed matches the Linux counterpart:</p> <div class=highlight ><pre><span></span> C:\Users\jaro\platform-tools&gt;adb.exe version
<span class=hll > Android Debug Bridge version 1.0.41
</span> Version 30.0.4-6686687
 Installed as C:\Users\jaro\platform-tools\adb.exe
</pre></div> <p>It does! We can now start the server:</p> <div class=highlight ><pre><span></span>C:\platform-tools&gt; adb.exe -a -P 5037 nodaemon server
</pre></div> <p>This command will run the ADB server in the foreground (I find it more convenient than running it in the background as it tells me that the server is indeed running on Windows). The <code>-a</code> option will make the server listen on all interfaces (important!) on port <code>5037</code>. Specifying a port is superfluous as the server by default starts on port <code>5037</code> but I included it for clarity reasons.</p> <p>The above might trigger a Windows firewall alert that will ask if we want to set up a rule for the ADB.</p> <img alt="Windows Defender Firewall dialog." src="https://blog.laobo.dev/blog/images/windows_defender_dialog.png" /> <p>From the perspective of accessing the ADB from WSL, it doesn't make much difference. If we allow the access then we'll be able to access the ADB server also from another computer on the network.</p> <p>We now have a working ADB server running. Let's take care of the client next.</p> </div> <div class=section  id=the-client > <h3>The client</h3> <p>The first thing we need to do to establish a connection to the server is to obtain the Windows IP address. There are two addresses we can use:</p> <div class=highlight ><pre><span></span> C:\Users\jaro&gt;ipconfig

 Ethernet adapter vEthernet (WSL):

 ...
<span class=hll > IPv4 Address. . . . . . . . . . . : 172.20.96.1
</span> Subnet Mask . . . . . . . . . . . : 255.255.240.0
 Default Gateway . . . . . . . . . :

 Wireless LAN adapter Wi-Fi:

 ...
<span class=hll > IPv4 Address. . . . . . . . . . . : 192.168.0.203
</span> Subnet Mask . . . . . . . . . . . : 255.255.255.0
 Default Gateway . . . . . . . . . : 192.168.0.1
</pre></div> <p>The first IP address is an address of a WSL virtual machine's interface <code>vEthernet (WS)</code> and in my case, it's <strong>172.20.96.1</strong>. The second address is the address of my Wi-Fi interface and it's <strong>192.168.0.203</strong>.</p> <p>We can use both of those addresses but in the case of the Wi-Fi address (or other physical interfaces), we have to enable access to <code>adb.exe</code> in Windows Defender Firewall. Otherwise, this approach will not work. That is why using the IP address of the virtual network interface is easier. Allowing communication between Windows and Linux is this interface's purpose after all.</p> <p>Getting the IP address of the server from Windows after every reboot is a little inconvenient. Luckily this address is also available for Linux in <em>/etc/resolv.conf</em> file <a class=footnote-reference  href="#footnote-5" id=footnote-reference-5 >[5]</a>:</p> <div class=highlight ><pre><span></span>$ cat cat /etc/resolv.conf
# This file was automatically generated by WSL...
# [network]
# generateResolvConf = false
nameserver 172.20.96.1
</pre></div> <p>Armed with the IP address of the server we can finally make the connection. We can do this by executing <code>adb</code> command with an IP address and TCP port of the server like below:</p> <div class=highlight ><pre><span></span>$ adb -H 172.20.96.1 -P 5037 devices
List of devices attached
0123456789A     device
</pre></div> <p>Specifying the IP address/hostname and port each time we want to access a device sounds tedious. There is a better way. We can make use of an <code>ADB_SERVER_SOCKET</code> environment variable:</p> <div class=highlight ><pre><span></span><span class=hll > $ export ADB_SERVER_SOCKET=tcp:$(cat /etc/resolv.conf | awk &#39;/nameserver/ {print $2}&#39;):5037
</span> $ adb devices
 List of devices attached
 0123456789A     device
</pre></div> <p>We could even put this into our <em>~/.bashrc</em> and not worry about it anymore.</p> </div> </div> <div class=section  id=summary > <h2>Summary</h2> <p>While not instantaneously obvious, accessing Android devices using ADB from Windows Subsystem for Linux is pretty easy. Once we set up the tools all it takes is to execute two commands.</p> <p>One on Windows to run the ADB server:</p> <div class=highlight ><pre><span></span>C:\platform-tools&gt; adb.exe -a -P 5037 nodaemon server
</pre></div> <p>And one on Linux to connect the ADB client to the server:</p> <div class=highlight ><pre><span></span>$ export ADB_SERVER_SOCKET=tcp:$(cat /etc/resolv.conf | awk &#39;/nameserver/ {print $2}&#39;):5037
</pre></div> <p>After that, it just works.</p> </div> <div class=section  id=further-reading > <h2>Further reading</h2> <ul class=footnotes > <li> <span class="docutils footnote" id=footnote-1 > <a class=fn-backref  href="#footnote-reference-1">[1]</a> </span> <span> <a class="reference external" href="https://docs.microsoft.com/en-us/windows/wsl/compare-versions#exceptions-for-using-wsl-1-rather-than-wsl-2">Exceptions for using WSL 1 rather than WSL 2</a> </span> <li> <span class="docutils footnote" id=footnote-2 > <a class=fn-backref  href="#footnote-reference-2">[2]</a> </span> <span> <a class="reference external" href="https://developer.android.com/studio/command-line/adb">Android Debug Bridge (adb)</a> </span> <li> <span class="docutils footnote" id=footnote-3 > <a class=fn-backref  href="#footnote-reference-3">[3]</a> </span> <span> <a class="reference external" href="https://developer.android.com/studio/releases/platform-tools">SDK Platform Tools release notes</a> </span> <li> <span class="docutils footnote" id=footnote-4 > <a class=fn-backref  href="#footnote-reference-4">[4]</a> </span> <span> <a class="reference external" href="https://stackoverflow.com/questions/53453640/is-there-a-way-to-install-an-older-version-of-android-platform-tools">Is there a way to install an older version of Android platform-tools?</a> </span> <li> <span class="docutils footnote" id=footnote-5 > <a class=fn-backref  href="#footnote-reference-5">[5]</a> </span> <span> <a class="reference external" href="https://docs.microsoft.com/en-us/windows/wsl/compare-versions#accessing-windows-networking-apps-from-linux-host-ip">Accessing Windows networking apps from Linux (host IP)</a> </span> </ul> </div> </div> </div> </article> </div> </section> <footer class="footer is-dark"> <div class="social has-text-centered"> <a href="https://www.facebook.com/jwierzbi" class="icon is-large"> <i class="fa fa-facebook-square fa-2x facebook-icon" aria-hidden=true ></i> </a> <a href="https://www.instagram.com/wierzbicki.jaroslaw/" class="icon is-large"> <i class="fa fa-instagram fa-2x instagram-icon" aria-hidden=true ></i> </a> <a href="https://twitter.com/j_wierzbicki" class="icon is-large"> <i class="fa fa-twitter-square fa-2x twitter-icon" style="color: #1da1f2;" aria-hidden=true ></i> </a> <a href="https://github.com/jwierzbi" class="icon is-large"> <i class="fa fa-github-square fa-2x github-icon" aria-hidden=true ></i> </a> <a href="https://www.linkedin.com/in/jaroslaw-wierzbicki-14845043" class="icon is-large"> <i class="fa fa-linkedin-square fa-2x linkedid-icon" aria-hidden=true ></i> </a> </div> <div class="content has-text-centered"> <p> Copyright &copy; JarosÅ‚aw Wierzbicki. The source code is licensed <a href="http://opensource.org/licenses/mit-license.php">MIT</a>. The website content is licensed <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>. </p> </div> </footer> <script src="https://getinsights.io/js/insights.js"></script> <script> insights.init('HXqdOSbsoDR9nzGe'); insights.trackPages(); </script>